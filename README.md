# üïµÔ∏è‚Äç‚ôÇÔ∏è Real-Time Transactions Analytics

### *MLOps Homework 3 ‚Äî –ë–µ–ª—å–∫–æ–≤–µ—Ü –ì—Ä–∏–≥–æ—Ä–∏–π (–ë–ü–ú–ò221)*

–°–µ—Ä–≤–∏—Å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –≤ –∫–∞—á–µ—Å—Ç–≤–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –∫—É—Ä—Å–µ –ú–¢–° –®–ê–î 2025 –≤ —Ä–∞–º–∫–∞—Ö –∑–∞–Ω—è—Ç–∏–π –ø–æ MLOps.
–î–∞—Ç–∞—Å–µ—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è [https://www.kaggle.com/competitions/teta-ml-1-2025](https://www.kaggle.com/competitions/teta-ml-1-2025)

–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ CSV –≤ Kafka, –ø–æ—Ç–æ–∫–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ clickhouse_init.sql
‚îú‚îÄ‚îÄ load_kafka.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ train.csv
```

## üõ†Ô∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã (–ø–æ—à–∞–≥–æ–≤–æ)

### –®–∞–≥ 1: –ü–æ–¥–Ω—è—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É Kafka –∏ Zookeeper

```bash
docker compose up -d zookeeper kafka kafka-setup kafka-ui
```

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ Kafka

```bash
docker compose run --rm load_kafka
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ClickHouse

```bash
docker compose up -d clickhouse
docker compose exec -it clickhouse clickhouse-client
```

### –®–∞–≥ 4: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

* SQL-–∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –Ω–∞–∏–±–æ–ª—å—à–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —à—Ç–∞—Ç—É –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ query.sql

* –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ CSV:

```bash
docker exec -i clickhouse clickhouse-client \
  --multiquery \
  --format=CSVWithNames \
  --query="$(cat query.sql)" > max_transaction_per_state.csv
```

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* CSV `train.csv` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
* –ü–æ—Ä—Ç—ã 2181, 9095, 8123, 9000, 8080 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã –Ω–∞ —Ö–æ—Å—Ç–µ.
* –í—Å–µ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ ClickHouse; –µ—Å–ª–∏ –±–∞–∑–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

## –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏–∏ (PARTITION BY toYYYYMM(transaction_time)) –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ (us_state, amount DESC) (ORDER BY) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –∫–∞–∂–¥–æ–º—É —à—Ç–∞—Ç—É. 

## üí° –ê–≤—Ç–æ—Ä

**–ì—Ä–∏–≥–æ—Ä–∏–π –ë–µ–ª—å–∫–æ–≤–µ—Ü**  
–ë–ü–ú–ò221
